# ðŸ³ Docker Setup Ð´Ð»Ñ BookStore API

## ÐžÐ±Ð·Ð¾Ñ€

ÐŸÐ¾Ð»Ð½Ð°Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ñ BookStore API Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Docker Ð¸ docker-compose Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¸ production deployment.

## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²

```
â”œâ”€â”€ Dockerfile              # Multi-stage Docker build
â”œâ”€â”€ docker-compose.yml      # Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
â”œâ”€â”€ nginx.conf              # Reverse proxy ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ init.sql                # Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ PostgreSQL
â”œâ”€â”€ .dockerignore           # Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Docker build
â”œâ”€â”€ .env.example            # ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
â””â”€â”€ docker-build.sh         # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ ÑÐ±Ð¾Ñ€ÐºÐ¸ (Linux/Mac)
```

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

```bash
# Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
cp .env.example .env

# ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
nano .env
```

### 2. Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº

```bash
# Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¾Ð±Ñ€Ð°Ð·Ð°
docker build -t bookstore-api:latest .

# Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
docker-compose up -d

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
docker-compose ps
```

### 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ð¾ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚Ð¸

```bash
# Health check
curl http://localhost:8000/health

# API Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
open http://localhost:8000/docs

# Ð§ÐµÑ€ÐµÐ· Nginx (Ð¿Ð¾Ñ€Ñ‚ 80)
curl http://localhost/health
```

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²

### API Container (bookstore-api)
- **Base Image**: python:3.11-slim
- **Multi-stage build** Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°
- **Non-root user** Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
- **Health check** Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
- **Port**: 8000

### Database Container (PostgreSQL)
- **Image**: postgres:15-alpine
- **Persistent storage** Ñ‡ÐµÑ€ÐµÐ· Docker volumes
- **Health check** Ñ pg_isready
- **Port**: 5432

### Cache Container (Redis)
- **Image**: redis:7-alpine
- **Persistent storage** Ñ AOF
- **Health check** Ñ redis-cli ping
- **Port**: 6379

### Reverse Proxy (Nginx)
- **Image**: nginx:alpine
- **Rate limiting** Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½
- **Security headers** Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹
- **Gzip compression** Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½
- **Ports**: 80, 443

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Docker Ð¾Ð±Ñ€Ð°Ð·Ð°

### Multi-stage Build
```dockerfile
# Stage 1: Builder - ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
FROM python:3.11-slim as builder
# ... ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð² venv

# Stage 2: Production - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ runtime
FROM python:3.11-slim as production
# ... ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ venv Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
```

### Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ
- âœ… Non-root Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ
- âœ… ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ base image
- âœ… Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
- âœ… Health check Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

### ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ
- âœ… .dockerignore Ð´Ð»Ñ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð½ÐµÐ½ÑƒÐ¶Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
- âœ… ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ»Ð¾ÐµÐ² Docker
- âœ… Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Python
- âœ… Ð¡Ð¶Ð°Ñ‚Ð¸Ðµ Ð² Nginx

## ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ

### Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
```bash
# Ð—Ð°Ð¿ÑƒÑÐº Ð² development Ñ€ÐµÐ¶Ð¸Ð¼Ðµ
docker-compose up

# ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
docker-compose up --build

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²
docker-compose logs -f api

# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñƒ
docker-compose exec api bash
```

### Production
```bash
# Ð¡Ð±Ð¾Ñ€ÐºÐ° production Ð¾Ð±Ñ€Ð°Ð·Ð°
docker build --target production -t bookstore-api:prod .

# Ð—Ð°Ð¿ÑƒÑÐº Ñ production ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÐµÐ¹
docker run -d \
  --name bookstore-api \
  -p 8000:8000 \
  --env-file .env.production \
  bookstore-api:prod
```

### ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³
```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker-compose ps

# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
docker stats

# Health check
docker-compose exec api curl http://localhost:8000/health
```

## ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ
- `DATABASE_URL` - URL Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº PostgreSQL
- `SECRET_KEY` - Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
- `JWT_SECRET_KEY` - ÐšÐ»ÑŽÑ‡ Ð´Ð»Ñ JWT Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð²

### ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ
- `REDIS_URL` - URL Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Redis (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ: redis://localhost:6379)
- `LOG_LEVEL` - Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ: INFO)
- `ENVIRONMENT` - ÐžÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ (development/staging/production)

## Volumes Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ

### Persistent Storage
- `postgres_data` - Ð”Ð°Ð½Ð½Ñ‹Ðµ PostgreSQL
- `redis_data` - Ð”Ð°Ð½Ð½Ñ‹Ðµ Redis
- `./logs` - Ð›Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

### Backup
```bash
# Backup PostgreSQL
docker-compose exec db pg_dump -U bookstore bookstore_db > backup.sql

# Restore PostgreSQL
docker-compose exec -T db psql -U bookstore bookstore_db < backup.sql
```

## Troubleshooting

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸
docker-compose logs api

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ health check
docker-compose exec api curl http://localhost:8000/health

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐµÑ€Ð²Ð¸ÑÑ‹
docker-compose restart
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð‘Ð”
docker-compose exec api python -c "
from bookstore.database import engine
print(engine.execute('SELECT 1').scalar())
"

# ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð‘Ð”
docker-compose down -v
docker-compose up -d
```

## Production Deployment

### Docker Registry
```bash
# Tag Ð´Ð»Ñ registry
docker tag bookstore-api:latest your-registry.com/bookstore-api:v1.0.0

# Push Ð² registry
docker push your-registry.com/bookstore-api:v1.0.0
```

### Kubernetes Deployment
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bookstore-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: bookstore-api
  template:
    metadata:
      labels:
        app: bookstore-api
    spec:
      containers:
      - name: api
        image: your-registry.com/bookstore-api:v1.0.0
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: bookstore-secrets
              key: database-url
```

## ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

### Health Check Response
```json
{
  "status": "healthy",
  "timestamp": "2024-01-10T10:00:00Z",
  "version": "1.0.0",
  "service": "bookstore-api",
  "checks": {
    "database": "healthy",
    "memory": "healthy",
    "disk_space": "healthy",
    "environment": "healthy"
  }
}
```

### Prometheus Metrics
- Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `/metrics` endpoint
- Ð’ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Grafana Ð´Ð»Ñ Ð²Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸

## Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸

1. âœ… **Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ñ** - Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾
2. ðŸ”„ **Environment Configuration** - Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ
3. â³ **CI/CD Pipeline** - ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑÑ‚Ð°Ð¿
4. â³ **Monitoring & Logging** - Ð¿Ð»Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ
5. â³ **Cloud Deployment** - Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ð°Ð¿